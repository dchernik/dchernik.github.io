"use strict";function ViewModel(){var a=this;a.numOfPlaces=ko.computed(function(){return Object.keys(mai.places).length}),a.inputValue=ko.observable(""),a.awesomeList=[],a.placesByType=ko.observableArray([]),a.placesListVisible=ko.observable(!1),a.showAttractions=ko.observable(!0),a.showHotels=ko.observable(!0),a.showTravel=ko.observable(!0),a.displayErrMsg=ko.observable(!1),a.placeGallery=ko.observableArray([]),a.galleryVisible=ko.observable(!1),a.loadingGallery=ko.observable(!1),a.weatherCondition=ko.observable(""),a.weatherIcon=ko.observable(""),a.temperature=ko.observable(""),a.wind=ko.observable(""),a.windSpeed=ko.observable(""),a.forecastVisible=ko.observable(!1),a.weatherLoc=ko.observable(""),a.forecast=ko.observableArray([]),a.animateGps=ko.observable(!1),a.streetViewLoading=ko.observable(!1),a.streetViewVisible=ko.observable(!1),a.disableOrNot=ko.computed(function(){return a.loadingGallery()||a.streetViewLoading()}),a.droppedMarkers=ko.observableArray([]),a.selectedPlace={name:ko.observable(""),address:ko.observable(""),phone:ko.observable(""),phoneHref:ko.observable(""),photo:ko.observable(""),website:ko.observable(""),gplus:ko.observable(""),rating:ko.observable("")},a.errMsg={header:ko.observable(""),paragraphs:ko.observableArray([])},a.galleryHelperVisible=ko.computed(function(){return 0===a.placeGallery().length}),mai.poisCategories.forEach(function(b){var c={name:b,items:ko.observableArray([]),showAllItems:!0};Object.keys(mai.places).forEach(function(d){mai.places[d].category===b&&(c.items.push(d),a.awesomeList.push(d))}),a.placesByType.push(c)}),a.awesomplete=new Awesomplete($("#awesominput")[0],{list:a.awesomeList,autoFirst:!0,minChars:1,maxItems:15}),a.closeErrMsg=function(){a.displayErrMsg(!1)},a.btnState=function(b){switch(b){case"Attractions":return a.showAttractions();case"Hotels":return a.showHotels();case"Travel":return a.showTravel()}},a.getGlyth=function(a){switch(a){case"Attractions":return"glyphicon-camera";case"Hotels":return"glyphicon-header";case"Travel":return"glyphicon-road"}},a.toggleForecast=function(){a.forecastVisible(!a.forecastVisible())},a.toggleCategory=function(b){var c;switch(b=b.name){case"Attractions":a.showAttractions(!a.showAttractions()),c=a.showAttractions();break;case"Hotels":a.showHotels(!a.showHotels()),c=a.showHotels();break;case"Travel":a.showTravel(!a.showTravel()),c=a.showTravel()}c?Object.keys(mai.places).forEach(function(c){mai.places[c].category===b&&a.awesomeList.indexOf(c)<0&&a.awesomeList.push(c)}):a.awesomeList=a.awesomeList.filter(function(c){return c===a.selectedPlace.name()&&(mai.closeIw(),a.selectedPlace.name("")),mai.places[c].category!==b}),a.awesomplete.list=a.awesomeList,a.toggleCategoryMarkers(b,c)},a.showCategory=function(b){switch(b=b.name){case"Attractions":return a.showAttractions();case"Hotels":return a.showHotels();case"Travel":return a.showTravel()}},a.showAll=function(){var b=[];a.showAttractions()||(a.showAttractions(!0),b.push("Attractions")),a.showHotels()||(a.showHotels(!0),b.push("Hotels")),a.showTravel()||(a.showTravel(!0),b.push("Travel")),b.forEach(function(b){a.toggleCategoryMarkers(b,!0),Object.keys(mai.places).forEach(function(c){mai.places[c].category===b&&-1===a.awesomeList.indexOf(c)&&a.awesomeList.push(c)})}),a.awesomplete.list=a.awesomeList},a.togglePlacesList=function(){a.placesListVisible(!a.placesListVisible())},a.toggleCategoryMarkers=function(b,c){var d;a.placesByType().forEach(function(a){b===a.name&&(d=a.items())}),d.forEach(function(a){mai.places[a].category===b&&c?mai.places[a].marker.setMap(mai.map):mai.places[a].category===b&&mai.places[a].marker.setMap(null)})},a.selectPlace=function(b){var c=mai.places[b].marker;a.loadingGallery(!1),a.streetViewLoading(!1),mai.closeIw(),mai.markerBounce(c),a.selectedPlace.name(b),mai.infowindow.setContent($(".iw-part").html()),mai.infowindow.open(mai.map,c),mai.execIfConnectedToServer(b,mai.getGooglePlaceDetails)},a.clearInput=function(){a.inputValue(""),mai.closeIw()},a.updatePlaces=function(b,c){var d,e=c.target.value.trim().toLowerCase();return a.clearPlacesByType(),""===e?(a.selectedPlace.name(""),void Object.keys(mai.places).forEach(function(b){d=mai.places[b].category,a.awesomeList.indexOf(b)>=0&&mai.places[b].marker.setMap(mai.map),a.placesByType().forEach(function(a){a.name===d&&a.items.push(b)})})):void a.placesByType().forEach(function(b){Object.keys(mai.places).forEach(function(d){d.toLowerCase().indexOf(e)>=0&&mai.places[d].category===b.name?(b.items.push(d),a.awesomeList.indexOf(d)>=0&&mai.places[d].marker.setMap(mai.map),d===c.target.value?a.selectPlace(d):(mai.closeIw(),a.selectedPlace.name(""))):mai.places[d].category===b.name&&mai.places[d].marker.setMap(null)})})},a.clearPlacesByType=function(){for(var b=0;b<a.placesByType().length;b++)a.placesByType()[b].items.removeAll()},a.requestPlaceGallery=function(){a.loadingGallery(!0),mai.execIfConnectedToServer("",mai.vm.showPlaceGallery)},a.showPlaceGallery=function(){var b=mai.infowindow.getPosition().A,c=mai.infowindow.getPosition().F,d=mai.vm.selectedPlace.name();a.placeGallery.removeAll(),a.getFlickrPhotos(b,c,d),a.getInstagramPhotos(b,c,d)},a.getInstagramPhotos=function(b,c,d){var e="33405dcafb524445ad9883cd0c431433",f=Object.keys(mai.places).indexOf(d)>=0?100:1600;$.ajax({url:"https://api.instagram.com/v1/media/search?&_=1",dataType:"jsonp",type:"GET",data:{lat:b,lng:c,distance:f,client_id:e}}).done(function(b){return 200!==b.meta.code?(console.error(b.meta.error_message),void mai.showMessage("Instagram API error.")):0===b.data.length?void mai.showMessage("Instagram 0 results."):(Object.keys(b.data).forEach(function(c){var d,e=b.data[c].caption?b.data[c].caption.text:"";"image"===b.data[c].type&&(d={},d.src=b.data[c].images.standard_resolution.url,d.title=e,d.author="https://instagram.com/"+b.data[c].user.username+"/",d.hosting="Instagram",a.placeGallery.push(d))}),void(a.galleryVisible()||a.selectedPlace.name()!==d||($("#bsModal").modal("show"),a.galleryVisible(!0))))}).fail(function(){mai.showMessage("Instagram API error.")})},a.getFlickrPhotos=function(b,c,d){var e="c82b369d7f0b0b53994f32e2c9620f51",f=Object.keys(mai.places).indexOf(d)>=0?1:1.6;$.ajax({url:"https://www.flickr.com/services/rest/?",dataType:"json",type:"GET",data:{method:"flickr.photos.search",format:"json",lat:b,lon:c,radius:f,tags:d,api_key:e,nojsoncallback:1}}).done(function(b,c,e){if(e.responseText.indexOf("fail")>-1){var f=e.responseText.slice(e.responseText.indexOf("message")+9,e.responseText.indexOf("}"));return console.error(f),void mai.showMessage("Flickr API error.")}a.addFlkrToPlaceGallery(b.photos.photo,d)}).fail(function(){mai.showMessage("Flickr API error.")})},a.addFlkrToPlaceGallery=function(b,c){if(0===b.length)return void mai.showMessage("Flickr 0 results.");var d,e="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_z.jpg";b.forEach(function(b){d={},d.src=e.replace("{farm-id}",b.farm),d.src=d.src.replace("{server-id}",b.server),d.src=d.src.replace("{id}",b.id),d.src=d.src.replace("{secret}",b.secret),b.title?d.title=b.title:d.title="",d.hosting="Flickr",d.author="https://www.flickr.com/people/"+b.owner+"/",a.placeGallery.push(d)}),a.galleryVisible()||a.selectedPlace.name()!==c||($("#bsModal").modal("show"),a.galleryVisible(!0))},a.requestStreetView=function(){a.streetViewLoading(!0),mai.execIfConnectedToServer("",mai.vm.showStreetView)},a.showStreetView=function(){var b=mai.infowindow.getPosition(),c=new google.maps.StreetViewService;c.getPanoramaByLocation(b,100,function(c,d){d===google.maps.StreetViewStatus.OK?(mai.panorama.setVisible(!1),mai.panorama.setPosition(b),mai.panorama.setVisible(!0),a.streetViewVisible(!0),a.streetViewLoading(!1)):mai.showMessage("Street View error.")})},a.closeStreetView=function(){mai.panorama.setVisible(!1),a.streetViewVisible(!1)}}var mai={},Offline=Offline||{},ko=ko||{},google=google||{},Awesomplete=Awesomplete||{};$(function(){window.google?mai.initializeMap():mai.showMessage("Lost connection to server."),mai.loadWeather(mai.neighborhood.lat+","+mai.neighborhood.lng)}),Offline.on("down",function(){mai.showMessage("Lost connection to server.")}),mai.execIfConnectedToServer=function(a,b){window.URL=window.URL||window.webkitURL;var c="/favicon.ico?_="+Math.floor(1e9*Math.random());mai.xhr=new XMLHttpRequest,mai.xhr.open("HEAD",c,!0),mai.xhr.onload=function(){void 0!==b&&"function"==typeof b&&b(a)},mai.xhr.onerror=function(){mai.showMessage("Lost connection to server.")},mai.xhr.send()},mai.showMessage=function(a){switch(mai.vm.loadingGallery(!1),mai.vm.streetViewLoading(!1),mai.vm.errMsg.paragraphs.removeAll(),a){case"Lost connection to server.":mai.vm.errMsg.header("Bad connection."),mai.vm.errMsg.paragraphs.push("It looks like there is no, or bad Internet connection."),mai.vm.errMsg.paragraphs.push("Some features of the app may still work, but to experience it to the fullest you will need a reliable Internet connection.");break;case"Image error.":mai.vm.errMsg.header(a),mai.vm.errMsg.paragraphs.push("Unfortunately previous image failed to load. It may be due to bad or no Internet connection."),mai.vm.errMsg.paragraphs.push("When issue is fixed please re-open gallery to see all the images.");break;case"Last image error.":var b=""===mai.vm.selectedPlace.name()?"selected place. ":mai.vm.selectedPlace.name()+". ";mai.vm.errMsg.header("Image error."),mai.vm.errMsg.paragraphs.push("Unfortunately all images failed to load for "+b+"."),mai.vm.errMsg.paragraphs.push("It may be due to bad or no Internet connection.");break;case"Street View error.":mai.vm.errMsg.header(a),mai.vm.errMsg.paragraphs.push("Street View data not found for this location at this moment.");break;case"Street View image failed.":mai.vm.errMsg.header(a),mai.vm.errMsg.paragraphs.push("Request to retrieve street view image for "+mai.vm.selectedPlace.name()+" failed. It may be caused by bad Internet connection.");break;case"Place details error.":mai.vm.errMsg.header(a),mai.vm.errMsg.paragraphs.push("Failed to get details for "+mai.vm.selectedPlace.name()+". Make sure your Internet link is up and try again."),mai.vm.errMsg.paragraphs.push("Report the issue if it persists.");break;case"Instagram API error.":mai.vm.errMsg.header("Instagram error."),mai.vm.errMsg.paragraphs.push("Failed to retrieve images for "+mai.vm.selectedPlace.name()+" from Instagram. Sorry for this mishap. Make sure you are connected to the Internet and try again."),mai.vm.errMsg.paragraphs.push("Report the issue if it persists.");break;case"Instagram 0 results.":mai.vm.errMsg.header("Instagram error."),mai.vm.errMsg.paragraphs.push("Could not find any available images for "+mai.vm.selectedPlace.name()+" on Instagram.");break;case"Flickr API error.":mai.vm.errMsg.header("Flickr error."),mai.vm.errMsg.paragraphs.push("Failed to retrieve images for "+mai.vm.selectedPlace.name()+" from Flickr. Sorry for this mishap. Make sure you are connected to the Internet and try again."),mai.vm.errMsg.paragraphs.push("Report the issue if it persists.");break;case"Flickr 0 results.":mai.vm.errMsg.header("Flickr error."),mai.vm.errMsg.paragraphs.push("Could not find any recent available images for "+mai.vm.selectedPlace.name()+" on Flickr.");break;case"No geometry.":mai.vm.errMsg.header("Search error."),mai.vm.errMsg.paragraphs.push("Please select a place from the list of suggestions and make sure you are connected to the Internet.");break;case"Geolocation 0 results.":mai.vm.errMsg.header("Geolocation service failed"),mai.vm.errMsg.paragraphs.push("We were unable to find you on Earth (:");break;case"Geolocation error.":mai.vm.errMsg.header("Geolocation service failed"),mai.vm.errMsg.paragraphs.push("The were no result returned from your request. We apologize for inconvenience. PLease try again later."),mai.vm.errMsg.paragraphs.push("Report the issue if it persists.");break;case"Geolocation failed.":mai.vm.errMsg.header("Geolocation service failed"),mai.vm.errMsg.paragraphs.push("We couldn't determine your precise location."),mai.vm.errMsg.paragraphs.push("It could be that the location services are turned off on your device, or it may be a permission issue. To help you solve the problem, here are short Google docs on the issue:"),mai.vm.errMsg.paragraphs.push('<a class="btn btn-success" role="button" href="https://support.google.com/gmm/answer/1250066?p=ml_location_help&hl=en&rd=1" target="location_docs">Mobile browser</a><a class="btn btn-success" role="button" href="https://support.google.com/maps/answer/152197?hl=en" target="location_docs">Desktop browser</a>');break;case"No geolocation support.":mai.vm.errMsg.header("The Geolocation service failed."),mai.vm.errMsg.paragraphs.push("Unfortunately your browser doesn't support geolocation."),mai.vm.errMsg.paragraphs.push("Any modern browser will most likely solve this issue.");break;case"Weather err.":mai.vm.errMsg.header("The Weather service failed."),mai.vm.errMsg.paragraphs.push("There was an error retrieving the latest weather information. Most likely due to absent data for current location"),mai.vm.errMsg.paragraphs.push("Hopefully this mishap will not spoil your experience here.");break;default:mai.vm.errMsg.header("Something went wrong. Please try again.")}mai.vm.displayErrMsg(!0)},mai.places={"Intrepid Sea, Air & Space Museum":{lat:40.764527,lng:-73.999608,googlePid:"ChIJnxlg1U5YwokR8T90UrZiIwI",category:"Attractions"},"Madame Tussauds":{lat:40.756463,lng:-73.988859,googlePid:"ChIJ8VOfr1RYwokRhil9_pcMKuc",category:"Attractions"},"The Museum of Modern Art":{lat:40.761433,lng:-73.977622,googlePid:"ChIJKxDbe_lYwokRVf__s8CPn-o",category:"Attractions"},"The Plaza Hotel":{lat:40.764469,lng:-73.974488,googlePid:"ChIJYaVdffBYwokRnTOoCzCq9mE",category:"Hotels"},"Hotel Pennsylvania":{lat:40.7500064,lng:-73.9909531,googlePid:"ChIJWbSN8q5ZwokRpLN00upxy8g",category:"Hotels"},"Four Seasons Hotel New York":{lat:40.762327,lng:-73.971282,googlePid:"ChIJ68J3tfpYwokR2HaRoBcB4xg",category:"Hotels"},"414 Hotel":{lat:40.761273,lng:-73.991744,googlePid:"ChIJhwBD1VNYwokR7eKcshuz914",category:"Hotels"},"The High Line Hotel":{lat:40.745996,lng:-74.005002,googlePid:"ChIJ-1XDX7hZwokRHLjn63mDetU",category:"Hotels"},"United Nations Headquarters":{lat:40.748876,lng:-73.968009,googlePid:"ChIJEU2H4BxZwokRNfY93Yvi-sU",category:"Attractions"},"Empire State Building Observation Deck":{lat:40.74844,lng:-73.985664,googlePid:"ChIJEwxwq6lZwokRnYSTMiceJsE",category:"Attractions"},"Flatiron Building":{lat:40.74106,lng:-73.989699,googlePid:"ChIJZx8c96NZwokRJklw7SVhKt4",category:"Attractions"},"Chrysler Building":{lat:40.751621,lng:-73.975502,googlePid:"ChIJeWPFRwJZwokRGD60OOo74RU",category:"Attractions"},"Rockefeller Center":{lat:40.75874,lng:-73.978674,googlePid:"ChIJ9U1mz_5YwokRosza1aAk0jM",category:"Attractions"},"Radio City Music Hall":{lat:40.759976,lng:-73.979977,googlePid:"ChIJPS8b1vhYwokRldqq2YHmxJI",category:"Attractions"},"Central Park Zoo":{lat:40.767778,lng:-73.971834,googlePid:"ChIJaWjW_PFYwokRFD8a2YQu12U",category:"Attractions"},"New York Public Library":{lat:40.753182,lng:-73.982253,googlePid:"ChIJqaiomQBZwokRTHOaUG7fUTs",category:"Attractions"},"St. Patrick's Cathedral":{lat:40.758465,lng:-73.975993,googlePid:"ChIJUW4vEPxYwokRW6o24DU0YIg",category:"Attractions"},"Madison Square Park":{lat:40.742037,lng:-73.987564,googlePid:"ChIJp32RvaZZwokRfH0Zgzl9mXk",category:"Attractions"},"Bryant Park":{lat:40.753596,lng:-73.983233,googlePid:"ChIJvbGg56pZwokRp_E3JbivnLQ",category:"Attractions"},"Grand Central Terminal":{lat:40.752726,lng:-73.977229,googlePid:"ChIJhRwB-yFawokRi0AhGH87UTc",category:"Travel"},"Port Authority Bus Terminal":{lat:40.756974,lng:-73.990499,googlePid:"ChIJxSvNNFNYwokRjrN1HB74O28",category:"Travel"}},mai.neighborhood={name:"Midtown, New Yourk, NY, USA",lat:40.7504877,lng:-73.9839238},mai.poisCategories=["Attractions","Hotels","Travel"],mai.bounds=null,mai.infowindow=null,mai.map=null,mai.panorama=null,mai.xhr=null,mai.initializeMap=function(){var a,b=new google.maps.LatLng(mai.neighborhood.lat,mai.neighborhood.lng),c={disableDefaultUI:!0,mapTypeControl:!0,center:b,minZoom:2,zoom:14,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR}},d=document.createElement("div"),e=document.getElementById("pac-input"),f=new google.maps.places.Autocomplete(e);mai.map=new google.maps.Map(document.querySelector("#map-canvas"),c),f.bindTo("bounds",mai.map),mai.panorama=mai.map.getStreetView(),mai.bounds=new google.maps.LatLngBounds(b),d.setAttribute("class","map-btns"),d.index=1,a=new mai.CustomMapControls(d,mai.map),mai.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(d),mai.map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),mai.infowindow=new google.maps.InfoWindow({maxWidth:260}),mai.createMarkers(),mai.map.fitBounds(mai.bounds),google.maps.event.addListener(mai.infowindow,"domready",function(){ko.applyBindings(mai.vm,$(".infowindow-container")[0]),$(".gm-style-iw .img-responsive").load(function(){window.URL.revokeObjectURL(this.src)})}),google.maps.event.addListener(f,"place_changed",function(){mai.closeIw(),mai.infowindow.setContent("");var a=f.getPlace();if(!a.geometry)return void mai.showMessage("No geometry.");var b=a.geometry.location,c=b.A+","+b.F;mai.vm.selectedPlace.name(a.name),mai.infowindow.setContent($(".iw-part").html()),mai.infowindow.setPosition(b),mai.infowindow.open(mai.map),mai.getStreetViewImg(b),a.geometry.viewport?mai.map.fitBounds(a.geometry.viewport):(mai.map.setCenter(b),mai.map.setZoom(17)),mai.createInfoWindowContent(a,a.name),mai.loadWeather(c)}),google.maps.event.addListener(mai.map,"click",function(){mai.closeIw(),mai.vm.selectedPlace.name(""),mai.vm.closeErrMsg(),mai.vm.forecastVisible(!1)})},mai.createInfoWindowContent=function(a,b){var c=a.formatted_phone_number?a.formatted_phone_number:"",d="tel: "+c,e=a.rating?mai.ratingStars(a.rating):"",f=mai.places[b]?mai.places[b].marker:null,g="";a.formatted_address?g=a.formatted_address:a.address_components&&(g=[a.address_components[0]&&a.address_components[0].short_name||"",a.address_components[1]&&a.address_components[1].short_name||"",a.address_components[2]&&a.address_components[2].short_name||""].join(" ")),b||(b=g,g=""),mai.vm.selectedPlace.name(b),mai.vm.selectedPlace.address(g),mai.vm.selectedPlace.phone(c),mai.vm.selectedPlace.phoneHref(d),mai.vm.selectedPlace.website(a.website),mai.vm.selectedPlace.gplus(a.url),mai.vm.selectedPlace.rating(e),mai.infowindow.setContent($(".info-window").html()),f?mai.infowindow.open(mai.map,f):mai.infowindow.open(mai.map)},mai.createMarkers=function(){var a=1;Object.keys(mai.places).forEach(function(b){var c=new google.maps.LatLng(mai.places[b].lat,mai.places[b].lng),d="images/"+mai.places[b].category+".png",e=new google.maps.Marker({title:b,draggable:!1,position:c,icon:d});google.maps.event.addListener(e,"click",function(){mai.vm.selectPlace(this.title)}),mai.bounds.extend(new google.maps.LatLng(c.lat(),c.lng())),window.setTimeout(mai.dropMarker,200*a++,e),mai.places[b].marker=e})},mai.dropMarker=function(a){a.setAnimation(google.maps.Animation.DROP),a.setMap(mai.map),mai.vm.droppedMarkers.push(a.title)},mai.getStreetViewImg=function(a){var b="https://maps.googleapis.com/maps/api/streetview?size=260x80&location="+a+"&fov=120";window.URL=window.URL||window.webkitURL,mai.xhr=new XMLHttpRequest,mai.xhr.open("GET",b+"&_="+Math.floor(1e9*Math.random()),!0),mai.xhr.responseType="blob",mai.xhr.onload=function(){if(200===this.status){var a=this.response;mai.vm.selectedPlace.photo(window.URL.createObjectURL(a))}else mai.showMessage("Street View image failed.")},mai.xhr.onerror=function(){mai.showMessage("Street View image failed.")},mai.xhr.send()},mai.getGooglePlaceDetails=function(a){var b=mai.places[a].lat+","+mai.places[a].lng,c=new google.maps.places.PlacesService(mai.map),d={placeId:mai.places[a].googlePid};mai.getStreetViewImg(b),c.getDetails(d,function(b,c){c===google.maps.places.PlacesServiceStatus.OK?mai.createInfoWindowContent(b,a):mai.showMessage("Place details error.")})},mai.ratingStars=function(a){if(!a)return"";var b,c=Math.ceil(a);return c-a>.7?c-=1:c-a>.2&&(c-=.5),b='<article class="place-rating-'+c+'"><span class="average-rating">'+a.toFixed(1)+'</span><ul class="stars"><li id="star-1"></li><li id="star-2"></li><li id="star-3"></li><li id="star-4"></li><li id="star-5"></li></ul><span class="reviews">Google+</span></article>'},mai.markerBounce=function(a){null!==a.getAnimation()?a.setAnimation(null):(a.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.setAnimation(null)},2100))},mai.CustomMapControls=function(a,b){var c=document.createElement("div"),d=document.createElement("div");c.setAttribute("class","gps-btn"),c.title="Something awesome",c.innerHTML='<svg><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg><img src="images/loading.gif">',a.appendChild(c),d.setAttribute("class","center-map-btn"),d.title="Click to recenter the map",d.innerHTML="Reset Position",a.appendChild(d),google.maps.event.addDomListener(c,"click",function(){mai.vm.animateGps(!0),mai.getLocation()}),google.maps.event.addDomListener(d,"click",function(){b.fitBounds(mai.bounds),b.setCenter(mai.bounds.getCenter()),mai.loadWeather(mai.neighborhood.lat+","+mai.neighborhood.lng)})},mai.closeIw=function(){mai.vm.selectedPlace.photo(""),mai.infowindow.close()},mai.getLocation=function(){mai.closeIw(),mai.vm.selectedPlace.name(""),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b,c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),d=a.coords.latitude+","+a.coords.longitude,e=new google.maps.Geocoder;e.geocode({latLng:c},function(a,e){e===google.maps.GeocoderStatus.OK?(b=a[1]||a[0]||a[2]||a[3]||a[4]||a[5]||a[6]||a[7]||a[8]||a[9]||null,mai.map.setZoom(17),mai.map.setCenter(c),mai.vm.selectedPlace.name(b.formatted_address),mai.infowindow.setContent($(".iw-part").html()),mai.infowindow.setPosition(c),mai.infowindow.open(mai.map),mai.getStreetViewImg(c),mai.createInfoWindowContent(b),mai.loadWeather(d)):e===google.maps.GeocoderStatus.ZERO_RESULTS?mai.showMessage("Geolocation 0 results."):mai.showMessage("Geolocation error."),mai.vm.animateGps(!1)})},function(){mai.handleNoGeolocation(!0)}):mai.handleNoGeolocation(!1)},mai.handleNoGeolocation=function(a){a?mai.showMessage("Geolocation failed."):mai.showMessage("No geolocation support."),mai.vm.animateGps(!1)},mai.loadWeather=function(a){$.simpleWeather({location:a,success:function(a){var b=a.city+", "+a.region+" "+a.country;mai.vm.weatherLoc(b),mai.vm.weatherCondition(a.currently+" "),mai.vm.weatherIcon("icon-"+a.code),mai.vm.temperature(a.temp+"°"+a.units.temp),""!==a.wind.speed&&(mai.vm.wind(a.wind.direction+" "+a.wind.speed),mai.vm.windSpeed(a.units.speed)),mai.vm.forecast.removeAll();for(var c=0;5>c;c++){var d=0===c?"Today":1===c?"Tomorrow":mai.dayFromToday(c),e={};e={day:d,condition:a.forecast[c].text,conditionCode:"icon-"+a.forecast[c].code,high:a.forecast[c].high+"°"+a.units.temp,low:a.forecast[c].low+"°"+a.units.temp},mai.vm.forecast.push(e)}},error:function(a){console.error(a.error),mai.showMessage("Weather err."),mai.vm.forecast.removeAll(),mai.vm.weatherCondition(""),mai.vm.weatherIcon(""),mai.vm.temperature("No data for "+mai.vm.selectedPlace.name()),mai.vm.wind(""),mai.vm.windSpeed(""),mai.vm.weatherLoc("No data for "+mai.vm.selectedPlace.name())}})},mai.dayFromToday=function(a){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=Date.now()+60*a*1e3*60*24,d=new Date(c).getDay();return b[d]},ko.bindingHandlers.showHelper={init:function(a){mai.carouselHelper=$(a).children().first(),$("#bsModal").on("hidden.bs.modal",function(){$("#carousel").carousel("pause"),mai.vm.placeGallery.removeAll(),mai.vm.galleryVisible(!1)}),$("#bsModal").on("shown.bs.modal",function(){$("#carousel").carousel("pause"),mai.vm.loadingGallery(!1)}),$(".slideshow-btn").click(function(){$("#carousel").carousel("cycle")}),$("#carousel").on("slid.bs.carousel",function(){mai.carouselHelper.remove()})},update:function(a,b){var c=b();c&&mai.carouselHelper&&(mai.carouselHelper.addClass("active"),$(a).prepend(mai.carouselHelper))}},ko.bindingHandlers.imgEvents={init:function(a){var b=$(a).parent(),c=$(a).next(".img-meta");$(a).error(function(){b.hasClass("active")&&b.siblings().length>0?(mai.showMessage("Image error."),b.next().addClass("active")):0===b.siblings().length&&(mai.showMessage("Last image error."),$("#bsModal").modal("hide")),b.remove()}),$(a).load(function(){c.removeClass("hidden"),b.addClass("no-background")})}},ko.bindingHandlers.fadeVisible={init:function(a,b){var c=b();$(a).toggle(c)},update:function(a,b,c){var d=b(),e=c(),f=e.fadeDuration||500;d?$(a).fadeIn(f):$(a).fadeOut(f)}},ko.bindingHandlers.observeInputValue={init:function(a,b){function c(){window.requestAnimationFrame(c),e(d.value)}var d=a,e=b();mai.customEvent=new Event("value-updated"),c()},update:function(a,b){var c=b(),d=ko.unwrap(c);a.value=d,a.dispatchEvent(mai.customEvent)}},mai.vm=new ViewModel,ko.applyBindings(mai.vm);